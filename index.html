<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lander Game v0.1</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #gameContainer {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 14px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
    </div>
    <div id="info">
        <div>Lander Game - Rapier Physics Demo</div>
        <div>Gravity: 9.8 m/sÂ² | Restitution: 0.7</div>
        <div>Press F for FPS counter | SPACE for more boxes</div>
    </div>

    <!-- PixiJS 8 from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8.10.2/dist/pixi.min.js"></script>

    <script type="module">
        let app, graphics, world, RAPIER;
        let rigidBodies = [];
        let showFPS = false;
        let lastTime = 0;
        let fps = 0;
        let frameCount = 0;

        async function init() {
            try {
                // Initialize Rapier physics
                RAPIER = await import('https://cdn.skypack.dev/@dimforge/rapier2d-compat');
                await RAPIER.init();
                console.log('Rapier physics engine initialized');

                // Create PixiJS application
                app = new PIXI.Application();
                await app.init({
                    width: 800,
                    height: 600,
                    backgroundColor: 0x1a1a2e,
                    antialias: true
                });

                document.getElementById('gameContainer').appendChild(app.canvas);

                // Create physics world with gravity
                const gravity = { x: 0.0, y: 9.8 };
                world = new RAPIER.World(gravity);
                console.log('Physics world created with gravity:', gravity);

                // Create graphics container
                graphics = new PIXI.Graphics();
                app.stage.addChild(graphics);

                // Create ground (static body)
                createGround();

                // Create falling boxes with Rapier physics
                createFallingBox(400, 100);
                createFallingBox(350, 50);
                createFallingBox(450, 30);
                
                console.log('Created', rigidBodies.length, 'rigid bodies');
                console.log('Canvas size:', app.screen.width, 'x', app.screen.height);

                // Setup input handling
                setupInput();

                // Start game loop
                app.ticker.add(gameLoop);

                console.log('Lander Game initialized - Rapier physics demo ready!');
            } catch (error) {
                console.error('Failed to initialize:', error);
            }
        }

        function createGround() {
            // Create ground rigid body (fixed/static)
            const groundBodyDesc = RAPIER.RigidBodyDesc.fixed()
                .setTranslation(400, 580);
            const groundBody = world.createRigidBody(groundBodyDesc);

            // Create ground collider
            const groundColliderDesc = RAPIER.ColliderDesc.cuboid(400, 20);
            world.createCollider(groundColliderDesc, groundBody);

            rigidBodies.push({
                body: groundBody,
                isGround: true,
                width: 800,
                height: 40,
                color: 0x4a4a4a
            });
        }

        function createFallingBox(x, y) {
            // Create dynamic rigid body
            const rigidBodyDesc = RAPIER.RigidBodyDesc.dynamic()
                .setTranslation(x, y);
            const rigidBody = world.createRigidBody(rigidBodyDesc);

            // Add some initial random velocity
            rigidBody.setLinvel({ x: (Math.random() - 0.5) * 2, y: 0 }, true);
            rigidBody.setAngvel(Math.random() - 0.5, true);

            // Create box collider
            const colliderDesc = RAPIER.ColliderDesc.cuboid(15, 15)
                .setRestitution(0.7) // Bounce factor
                .setFriction(0.5);   // Friction
            world.createCollider(colliderDesc, rigidBody);

            rigidBodies.push({
                body: rigidBody,
                isGround: false,
                width: 30,
                height: 30,
                color: 0xff6b6b
            });
        }

        function setupInput() {
            window.addEventListener('keydown', (event) => {
                switch(event.code) {
                    case 'KeyF':
                        showFPS = !showFPS;
                        break;
                    case 'Space':
                        // Add a new falling box at random position
                        createFallingBox(Math.random() * 700 + 50, 50);
                        break;
                }
            });
        }

        function gameLoop(delta) {
            frameCount++;
            
            // Step the physics simulation
            world.step();

            // Clear graphics
            graphics.clear();

            // Draw all rigid bodies
            for (const bodyData of rigidBodies) {
                const position = bodyData.body.translation();
                const rotation = bodyData.body.rotation();

                // Draw the body
                graphics.beginFill(bodyData.color);
                graphics.drawRect(
                    position.x - bodyData.width/2,
                    position.y - bodyData.height/2,
                    bodyData.width,
                    bodyData.height
                );
                graphics.endFill();
                
                // Draw rotation indicator for non-ground bodies
                if (!bodyData.isGround) {
                    graphics.lineStyle(2, 0xffffff);
                    const lineLength = 20;
                    const endX = position.x + Math.cos(rotation) * lineLength;
                    const endY = position.y + Math.sin(rotation) * lineLength;
                    
                    graphics.moveTo(position.x, position.y);
                    graphics.lineTo(endX, endY);
                }
            }

            // FPS calculation and display
            if (showFPS) {
                const currentTime = Date.now();
                if (currentTime - lastTime >= 1000) {
                    fps = Math.round(app.ticker.FPS);
                    lastTime = currentTime;
                }
                
                // Create FPS text
                const fpsText = new PIXI.Text(`FPS: ${fps}`, {
                    fontFamily: 'Arial',
                    fontSize: 16,
                    fill: 0xffffff
                });
                fpsText.position.set(10, 80);
                app.stage.addChild(fpsText);
                
                // Remove text after this frame
                app.ticker.addOnce(() => {
                    app.stage.removeChild(fpsText);
                });
            }

            // Add instruction text
            const instructionText = new PIXI.Text('Press SPACE to add more boxes', {
                fontFamily: 'Arial',
                fontSize: 14,
                fill: 0xcccccc
            });
            instructionText.position.set(10, app.screen.height - 30);
            app.stage.addChild(instructionText);
            
            // Add debug info
            const debugText = new PIXI.Text(`Frame: ${frameCount} | Bodies: ${rigidBodies.length}`, {
                fontFamily: 'Arial',
                fontSize: 12,
                fill: 0x00ff00
            });
            debugText.position.set(10, app.screen.height - 70);
            app.stage.addChild(debugText);
            
            app.ticker.addOnce(() => {
                app.stage.removeChild(instructionText);
                app.stage.removeChild(debugText);
            });
        }

        // Initialize the game
        init().catch(console.error);
    </script>
</body>
</html> 